<!doctype html>
<html>

<head>
    <!-- <script type="module" src="https://unpkg.com/data-i18n/dist/data-i18n/data-i18n.esm.js"></script>
    <script nomodule src="https://unpkg.com/data-i18n/dist/data-i18n/data-i18n.js"></script> -->
    <!-- In development -->
    <script type="module" src="/dist/data-i18n/data-i18n.esm.js"></script>
    <script nomodule src="/dist/data-i18n/data-i18n.js"></script>
    <!--  -->
</head>

<body>
    <h1>
        <i18n-t>The title of the page</i18n-t>
    </h1>
    <p>
        <i18n-t data-i18n='{"name": "i18n Babel!", "url": "https://data-i18n.com"}'>Visit us: <a href="(% url %)">(% name %)</a></i18n-t>
    </p>
    <p>
        <i18n-t>This text is <strong>not</strong> yet translated, but it is already identified in all.json file</i18n-t>
    </p>
    <p><i18n-t>This text is <strong>not</strong> translated anywhere</i18n-t></p>
    <p data-i18n>This text is <strong>not</strong> translated anywhere</p>

    <p onclick="changeCounter()">
        <i18n-t id="counter" data-i18n='{ "count": 0 }'>Click me to change my counter display! (% count %)</i18n-t>
    </p>
    <p onclick="changeSubtree()">
        <i18n-t>Changes in subelements will also be detected, click me to change <strong id="subtree">subelement</strong></i18n-t>
    </p>

    <p id="codeTranslated"></p>

    <label for="lang" id="langLabel" data-i18n>
        Select language (current: (% current %), guessed: (% guessed %)):
    </label>
    <select id="langSelect" name="lang" onchange="setLanguage()">
        <option value="" id="defaultLang" data-i18n='{"defaultLang": "unknown"}'>Default ((% defaultLang %))</option>
        <option value="ca" i18n-t>Catalan</option>
        <option value="en" i18n-t>English</option>
        <option value="ru" i18n-t>Russian</option>
    </select>

    <p></p>
    <button onclick="addNewElement()">Add new translated element</button>

    <script>
        const counter = document.getElementById('counter');
        const langLabel = document.getElementById('langLabel');
        const langSelect = document.getElementById('langSelect');
        const defaultLang = document.getElementById('defaultLang');
        const codeTranslated = document.getElementById('codeTranslated');

        // Wait for Translator to be available
        document.addEventListener('i18n-translator-ready', async () => {
            Translator.init({
                assetsLocation: '/examples/plain-js',
                isLocalValuesAllowed: true,
                isShowMissing: true,
                availableLangs: ['ca', 'en'],
            });
            langLabel.setAttribute('data-i18n', `{ "current": "${Translator.getCurrentLanguage()}", "guessed": "${Translator.guessLanguage(true)}" }`);
            defaultLang.setAttribute('data-i18n', `{ "defaultLang": "${Translator.getDefaultLanguage()}" }`);
            codeTranslated.innerHTML = await Translator.t('This text is translated programatically using <code>Translator.t</code> function');
        });

        let clicks = 0;
        function changeCounter() {
            clicks += 1;
            counter.setAttribute('data-i18n', `{ "count": ${clicks} }`);
        }

        function changeSubtree() {
            const subtree = document.getElementById('subtree');
            clicks += 1;
            subtree.innerHTML = `clicks: ${clicks}`;
        }

        async function setLanguage() {
            const { value } = langSelect;
            const newLang = Translator.setLanguage(value);
            langLabel.setAttribute('data-i18n', `{ "current": "${Translator.getCurrentLanguage()}", "guessed": "${Translator.guessLanguage(true)}" }`);
            codeTranslated.innerHTML = await Translator.t('Desired language: (% value %). Picked one: (% newLang %)', { value, newLang });
        }

        function addNewElement() {
            const pi18n = document.createElement('p');
            pi18n.setAttribute('data-i18n', '');
            pi18n.innerHTML = 'This element is added by code';
            document.body.appendChild(pi18n);
        }
    </script>
</body>

</html>